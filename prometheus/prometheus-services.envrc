export PROMETHEUS_OPERATOR_INSTALLED=true

# The default Kubernetes resources rules includea CPU Throttling
# alert that is frequently triggered inappropriately for spikey low-usage
# processes due to a Linux kernel bug, so we do not install them.
# See https://github.com/kubernetes/kubernetes/pull/63437
export PROMETHEUS_OPERATOR_RULES_KUBERNETES_RESOURCES_ENABLED=false
export PROMETHEUS_OPERATOR_RULES_KUBERNETES_RESOURCES_ALTERNATE_ENABLED=true

export PROMETHEUS_OPERATOR_PROMETHEUS_RETENTION_PERIOD=45d
export PROMETHEUS_OPERATOR_PROMETHEUS_STORAGE_SIZE=100G
export PROMETHEUS_OPERATOR_PROMETHEUS_STORAGE_CLASS=efs

# HTTPS does not work, see See https://github.com/coreos/prometheus-operator/issues/926
export PROMETHEUS_KUBELET_HTTPS=false
# Some installations use a label name of "component", and it is the chart default, but kops uses "k8s-app"
export PROMETHEUS_KUBE_K8S_APP_LABEL_NAME=true

# Configuration file, relative to releases/ directory
# export PROMETHEUS_ADDITIONAL_CONFIG_YAML="../prometheus-config.yaml"
export PROMETHEUS_PROMETHEUS_EXTERNAL_URL="https://prometheus.${KOPS_CLUSTER_NAME}/"

export PROMETHEUS_PROMETHEUS_LIMIT_CPU=1000m
export PROMETHEUS_PROMETHEUS_LIMIT_MEMORY=4096Mi

# Set according to whether the cluster is using kubeDNS or CoreDNS
export PROMETHEUS_EXPORTER_CORE_DNS_ENABLED=true
export PROMETHEUS_EXPORTER_KUBE_DNS_ENABLED=false

export GRAFANA_INSTALLED=true
export GRAFANA_INGRESS_ENABLED=false
export GRAFANA_IAM_ROLE=${AWS_METRICS_IAM_ROLE}

# GRAFANA_HOSTNAME is required if INGRESS is enabled
#export GRAFANA_HOSTNAME=
# Kubecost wants the PUBLIC Grafana URL broken down into parts
export PROMETHEUS_GRAFANA_DOMAIN="grafana.${KOPS_CLUSTER_NAME}"
export PROMETHEUS_GRAFANA_SCHEME="https"
# Grafana needs to know its public URL so it can construct links
# Grafana wants its URL in one piece
export PROMETHEUS_GRAFANA_ROOT_URL="${PROMETHEUS_GRAFANA_SCHEME}://${PROMETHEUS_GRAFANA_DOMAIN}"

# We prefer to install the dashboards via API, because then they are
# immediately editable. Otherwise you have to make copies first.
export PROMETHEUS_GRAFANA_DEFAULT_DASHBOARDS_ENABLED=false

export PROMETHEUS_ALERTMANAGER_EXTERNAL_URL="https://alertmanager.${KOPS_CLUSTER_NAME}/"

# This allows people to use Grafana without requiring we give them an account
export PROMETHEUS_ANONYMOUS_ADMIN_ENABLED=false
# This automatically gives them an admin account if they have a
# Keycloak account and get past Gatekeeper
export PROMETHEUS_KEYCLOAK_GATEKEEPER_ENABLED=true

## Disable older, conflicting stuff
# kube-prometheus components
export KUBE_PROMETHEUS_INSTALLED=false
export KUBE_PROMETHEUS_PUSH_GATEWAY_INSTALLED=false
export KUBE_PROMETHEUS_PUSH_GATEWAY_MONITOR_INSTALLED=false
export KUBE_PROMETHEUS_GRAFANA_INSTALLED=false

# kube-prometheus alerts managers components
#export KUBE_PROMETHEUS_ALERT_MANAGER_SLACK_CHANNEL=

# Add to Chamber KOPS?
export KUBE_PROMETHEUS_ALERT_MANAGER_SALONS_SLACK_CHANNEL="#alerts_salons"
